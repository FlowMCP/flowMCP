# FlowMCP Schema Spec v1.0.0

This document defines the structure and rules for creating schema definitions compatible with the given validation logic.

## Schema Definition

A schema is an object with the following structure:

### Meta

- `name` *(string, required)*: The name of the schema.
- `description` *(string, required)*: Description of the schema.
- `version` *(string, required)*: Schema version in the format `x.x.x`.
- `flowMCP` *(string, required)*: Current specification version, must match `version` format (`x.x.x`).
- `root` *(string, required)*: Root URL, must be a valid URL.
- `requiredServerParams` *(array of strings, required)*: Parameters required from the server-side.
- `headers` *(object, required)*: One-dimensional key-value object for HTTP headers. Example:
  ```json
  { "apiKey": "Bearer {{MY_SECRET}}" }
  ```

### Routes

Each schema can have multiple routes defined under the `routes` key, structured as an object with the route name as the key.

Each route contains:
- `requestMethod` *(string, required)*: HTTP request method, valid options: `GET`, `POST`.
- `description` *(string, required)*: Description of the route functionality.
- `route` *(string, required)*: Endpoint path.
- `parameters` *(array of objects, required)*: Defines request parameters.
- `tests` *(array of objects, required)*: Defines test cases.
- `modifiers` *(array of objects, required)*: Defines post-processing modifiers.

### Parameter Object

Each parameter is defined by:
- `position` *(object, required)*:
  - `key` *(string, required)*: Parameter name.
  - `value` *(string, required)*: Parameter value; can be static or dynamic placeholders (`{{USER_PARAM}}`).
  - `location` *(string, required)*: Parameter location, valid options: `body`, `query`, `insert`.
- `z` *(object, optional)*: Required only if `value` is `{{USER_PARAM}}`.
  - `primitive` *(string, required)*: Type of data, valid primitives: `string()`, `number()`, `boolean()`, `object()`.
  - `options` *(array, optional)*: Validation functions, valid options include:
    - `min(value)`
    - `max(value)`
    - `length(value)`
    - `enum(value1,value2,...)`
    - `regex(expression)`
    - `optional()`
    - `default(value)`

### Modifiers

Modifiers define post-processing actions:
- `phase` *(string, required)*: Valid phases: `post`.
- `handlerName` *(string, required)*: Name of the handler function defined in the schema's handlers object.

### Tests

Each test case within a route:
- `_description` *(string, required)*: Description of the test case.
- Parameters with corresponding keys matching required/optional user parameters defined in route.

### Handlers

Defined within the schema as an object containing functions:
```js
handlers: {
  handlerName: async ({ struct, payload }) => {
    // Custom logic to modify struct or payload
    return { struct, payload };
  }
}
```

### Required Server Params

Server parameters referenced in headers or parameters (other than `{{USER_PARAM}}`) must be declared within `requiredServerParams`.

## Example

A basic schema object definition in compliance with the above specification:

```js
const schema = {
  name: "API Schema",
  description: "Example API schema",
  version: "1.0.0",
  flowMCP: "1.0.0",
  root: "https://api.example.com",
  requiredServerParams: ["MY_SECRET"],
  headers: {
    "Authorization": "Bearer {{MY_SECRET}}"
  },
  routes: {
    exampleRoute: {
      requestMethod: "GET",
      description: "Example route",
      route: "/example",
      parameters: [
        { position: { key: "param1", value: "{{USER_PARAM}}", location: "query" }, z: { primitive: "string", options: ["min(1)", "max(100)"] } },
        { position: { key: "apikey", value: "{{MY_SECRET}}", location: "query" } }
      ],
      tests: [
        { _description: "Basic test", param1: "test" }
      ],
      modifiers: [
        { phase: "post", handlerName: "postProcess" }
      ]
    }
  },
  handlers: {
    postProcess: async ({ struct, payload }) => {
      // Example processing
      return { struct, payload };
    }
  }
};

export { schema };
```